{
  "hash": "bfd50432d4243fbf07f0e501a3b62664",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Technical Appendix\"\nauthor: \"Tim Wen & Ye Zhang\"\nformat: \n  html:\n    toc: true\n    toc-location: left\n    code-fold: show\n    theme: cosmo\n---\n\n# THE PROBLEM\n\nEviction is a serious issue; it can lead to housing instability, homelessness, and long-term negative health outcomes. Eviction is a cyclical event that could perpetuate poverty and community disinvestment. The more evictions that happen in a neighborhood, the higher the chance it will continue to experience the same issue.\n\nSome of the main priority groups are low-income renters, households that experience housing burden, and areas with high unemployment rates. The issue our team is trying to look at is the Eviction problem across Philadelphia County at the census tract level. We have collected all the housing eviction data from Eviction Lab Philadelphia tracking.\n\nOur model is trying to look at various predictors that may contribute to the issue of housing eviction and has a tool that would better predict where the next eviction cold spot is. We hope this tool could further inform policymakers to target potential eviction spots in advance and distribute resources to ensure everyone has a safe home to stay.\n\nSome of the tangible actions that we wish to see include emergency rental assistance funds before the actual evictions occur and identifying neighborhoods for proactive tenant outreach programs to prevent eviction from happening in the first place.\n\n# Data Processing\n### Load Library\n\n::: {.cell cathe='true'}\n\n```{.r .cell-code}\n#load packages\nlibrary(tidycensus) \nlibrary(tidyverse)\nlibrary(here)\nlibrary(lubridate)\nlibrary(dplyr)\nlibrary(sf)\nlibrary(tigris)\nlibrary(spatstat)\nlibrary(terra)\nlibrary(ggplot2)\nlibrary(arrow)\nlibrary(tigris)\nlibrary(car)\nlibrary(lmtest)\nlibrary(spdep)\nlibrary(ggpubr)\nlibrary(ggplot2)\nlibrary(cowplot)\nlibrary(stargazer)\nlibrary(knitr)\nlibrary(ggpubr)\noptions(tigris_use_cache = TRUE)\noptions(tigris_progress = FALSE) \n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#load monthly eviction data\ndf=read.csv(here(\"final/philadelphia_monthly_2020_2021.csv\"))\ndf$week_date <- my(df$month)\ndf$first_of_month=floor_date(df$week_date,\"month\")\n```\n:::\n\n\n### Philadelphia shapefile\n\n::: {.cell}\n\n```{.r .cell-code}\ncensus_path <- here(\"final\", \"Philly Census\")\n\ncensus_shp_path <- file.path(census_path, \"philly_tract.shp\")\n\nphilly_tract_sf <- st_read(census_shp_path, quiet = TRUE)\n```\n:::\n\n\nBelow are all of the ACS Variables that we think are important and relevant to the care of housing evictionin Philadelphia.\n\n-   Median gross rent: (B25064)\n-   Race: (B02001)\n-   Median household income: (B19013)\n-   % of Renter: (B25003)\n-   Year Built(renter): (B25036)\n-   Number of Room: (B25017)\n-   Room Per Household: (B25020)\n-   Family Structure: (B11001)\n-   Unemployment in labor force: (C18120)\n-   Gross Rent as a Percentage of Household Income: (B25070)\n\n### census data collected\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphilly_tract_data=read.csv(here(\"final\", \"philly_tract_data.csv\"))\n\nphilly_tract=tracts( state = 'PA',\n                     county = '101',\n                     year = 2023\n)\n\nphilly_tract_sf=philly_tract%>%\n  select(GEOID,geometry)\n```\n:::\n\n\n\n### Dewey rental data\n\nAs the median gross rent in ACS 5-year census data fails to capture the temporal monthly changes, we use Dewey rental data to compensate it. Dewey rentalhub web-scraped rental data from over 100+ sources. It has both specific locations, rental prices and date posted, making it possible for us to filter it to Philadelphia and then calculate the median gross rent by census tract per month to see how the changes in rent influence the eviction rate monthly. \n\n::: {.cell}\n\n```{.r .cell-code}\n#input data\nfolder_path <- here(\"final\", \"rental-in-philly\")\nall_parquet_files <- open_dataset(\n  sources = folder_path, \n  format = \"parquet\"\n)\ncombined_df <- all_parquet_files %>%\n  collect()\n\n#reproject it\nrental_shp=combined_df%>%\n  st_as_sf(coords = c(\"LONGITUDE\", \"LATITUDE\"), crs = 4326)\n\n#input city limit data  \napi_url <- \"https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/City_Limits/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson\"\ncity_limits_data <- st_read(api_url)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `OGRGeoJSON' from data source \n  `https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/City_Limits/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson' \n  using driver `GeoJSON'\nSimple feature collection with 1 feature and 3 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: -75.28031 ymin: 39.86747 xmax: -74.95575 ymax: 40.13793\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nrental_shp_proj <- st_transform(rental_shp, crs = 32618)\ncity_limits_data_proj <- st_transform(city_limits_data, crs = 32618)\n\n#filter to philadelphia\nphillyrental_proj <- st_filter(rental_shp_proj, city_limits_data_proj, .pred = st_within)\n\n#filter to different times\nphillyrental_proj_1923=phillyrental_proj%>%\n  filter(\n  year(DATE_POSTED) %in% c(2019:2023)\n)\n\nphilly_tract_sf=st_transform(philly_tract_sf,crs=32618)\n\n#merge with census tract\nphillyrental_proj_1923=phillyrental_proj_1923%>%\n  st_join(philly_tract_sf,join = st_within)\n```\n:::\n\n\n\n### Load quartly wage data\n\nMoreover, we also consider if the change on the wage would influence the eviction rate. However, there is no tract level wage data per month. Instead, we use Philadelphia wage data by quarter, which means we have to assume wage level on different census tract is the same. \n\n::: {.cell}\n\n```{.r .cell-code}\nfile_list <- list.files(\n  path = here(\"final\"),\n  pattern = \"q1-q4.*42101.*Philadelphia.*\\\\.csv\",\n  full.names = TRUE\n)\nwage_data <- file_list %>%\n  set_names() %>% \n  map_df(~ read_csv(.x), .id = \"source_file\")%>%\n  filter(own_title==\"Total Covered\")%>%\n   dplyr::select(year,qtr,avg_wkly_wage)\n```\n:::\n\n\n### Merge wage data with evictation data\n\n::: {.cell}\n\n```{.r .cell-code}\ndf$quarter=quarter(df$week_date)\ndf$year=year(df$week_date)\ndf$yearqu=paste0(df$year, df$quarter)\nwage_data$yearqu=paste0(wage_data$year,wage_data$qtr)\ndf=wage_data%>%\n  dplyr::select(yearqu,avg_wkly_wage)%>%\n  right_join(df,by=\"yearqu\")\n```\n:::\n\n\n### Merge with different CPI and unemployment rate per month in Philadelphia\n\nWe also consider other potential living cost that would make people difficult to afford the rent, such as food and electricity, especially after the pandemic food and electricity is getting much more expensive. We use CPI to account for the potential price level increase for these living cost that may influence the eviction rate. What's more, unemployment rate is also included, as more people may not afford the rent when unemployment rate increases. \n\nSimilar to wage data, none of them have monthly data on the census tract level, so we use Philadelphia as the geography and assume the whole geography is homogenous instead. \n\n::: {.cell}\n\n```{.r .cell-code}\nfood=read.csv(here(\"final\", \"food.csv\"))\nelectricity=read.csv(here(\"final\", \"electricity.csv\"))\ncommodities=read.csv(here(\"final\", \"commodities.csv\"))\n\n#merge with electricity cpi\ndf$month=month(df$week_date)\nelectricity$month=as.numeric(gsub(\"M\",\"\",electricity$Period))\ndf$yearm=paste0(df$year,df$month)\nelectricity$yearm=paste0(electricity$Year,electricity$month)\n\ndf=electricity%>%\n  mutate(electricitycpi=Value)%>%\n  dplyr::select(yearm,electricitycpi)%>%\n  right_join(df,by=\"yearm\")\n\n#merge with food cpi\nfood$first_of_month=ym(food$Label)\ndf=food%>%\n  mutate(foodcpi=Value)%>%\n  dplyr::select(first_of_month,foodcpi)%>%\n  right_join(df, by=\"first_of_month\")\n\ndf=df%>%\n  arrange(week_date)%>%\n  fill(foodcpi, .direction = \"up\")\n\n#merge with commodities cpi\n\ncommodities = commodities %>%\n  mutate(\n    comcpi = Value, \n    half_year_date = case_when(\n      Period == \"S01\" ~ ymd(paste(Year, \"01\", \"01\")), \n      Period == \"S02\" ~ ymd(paste(Year, \"07\", \"01\"))  \n    )\n  ) %>%\n  dplyr::select(half_year_date, comcpi)\n\ndf = df %>%\n  left_join(commodities, by = c(\"first_of_month\" = \"half_year_date\"))\n\ndf = df %>%\n  arrange(week_date) %>%\n  fill(comcpi, .direction = \"down\")\n```\n:::\n\n\n### Merge with unemployment data\n\n::: {.cell}\n\n```{.r .cell-code}\nunemployment=read.csv(here(\"final\", \"unemployment.csv\"))\nunemployment$week_date=ym(unemployment$Label)\ndf=unemployment%>%\n  mutate(unemployment_rate=Value)%>%\n  dplyr::select(unemployment_rate,week_date)%>%\n  right_join(df,by=\"week_date\")\n```\n:::\n\n\n### Merge with census data \n\n::: {.cell}\n\n```{.r .cell-code}\nphilly_tract_data$GEOID=as.character(philly_tract_data$GEOID)\n\ndf_census=df%>%\n  left_join(philly_tract_data,by=\"GEOID\")\n\n\ndf_census_sf=philly_tract_sf%>%\n  left_join(df_census,by=\"GEOID\")\n```\n:::\n\n\n### Merge with neighborhood data\n\nReading in Philadelphia Neighborhoods as a shp object. This will allow us to aggregate data on neighborhoods to identify neighborhood fixed effect.\n\n::: {.cell}\n\n```{.r .cell-code}\nneighborhood_folder <- here(\"final\", \"philadelphia-neighborhoods\")\nneighborhood_path   <- file.path(neighborhood_folder, \"philadelphia-neighborhoods.shp\")\n\n\n\n\n# Read the shapefile\nphilly_neighborhoods <- st_read(neighborhood_path, quiet = TRUE)\n\nphilly_neighborhoods=st_transform(philly_neighborhoods, crs=32618)\ncensus_points=st_centroid(df_census_sf)\ndf_census_sf=st_transform(df_census_sf,crs=32618)\ncensus_points=st_transform(census_points,crs=32618)\n\npoints_joined <- st_join(census_points, philly_neighborhoods)\ndf_census_sf=st_join(df_census_sf,philly_neighborhoods)\n# Calculate mean MHI for each polygon\nmean_mhi_by_poly <- points_joined %>%\n  st_drop_geometry() %>%             \n  group_by(MAPNAME) %>%            \n  summarise(meanMHI = mean(median_hh_income, na.rm = TRUE))\n\n# Join the result back to the polygon layer\ndf_census_sf_final <- df_census_sf %>%\n  left_join(mean_mhi_by_poly, by = \"MAPNAME\")%>%\n  st_as_sf() \n# reclassify the neighborhood data based on quantile (25%)\ndf_census_sf_final$MHI_quantile <- cut(\n  df_census_sf_final$meanMHI,\n  breaks = quantile(\n    df_census_sf_final$meanMHI,\n    probs = seq(0, 1, 0.25),   \n    na.rm = TRUE\n  ),\n  include.lowest = TRUE,\n  labels = c(\"Q1 (lowest)\", \"Q2\", \"Q3\", \"Q4 (highest)\")\n)\n```\n:::\n\n\n### Merge with rent data\n\n::: {.cell}\n\n```{.r .cell-code}\n#calculate rent by month and tract\nrent_by_month_tract=phillyrental_proj_1923%>%\n  st_drop_geometry()%>%\n  mutate(date=format(DATE_POSTED,\"%Y-%m\"))\n\nrent_by_month_tract=rent_by_month_tract%>%\n  dplyr::select(GEOID,RENT_PRICE,date)%>%\n  group_by(GEOID,date)%>%\n    summarise(median_rent=median(RENT_PRICE))\n```\n:::\n\n\n### Commercial and office points of interests (Amenities)(alternative in the next section if you do not want to download pbf data)\n\n::: {.cell}\n\n```{.r .cell-code}\n# downloading osm data from geofabrik:https://download.geofabrik.de/north-america/us-northeast.html\n\n#input_pbf <- \"the pdf file downloaded from the link above\"\n\n\n# get boundary of Philadelphia County\npa_counties <- counties(state = \"PA\", year = 2023)\n\n# Filter to Philadelphia County\nphilly_boundary <- subset(pa_counties, NAME == \"Philadelphia\")\n\n# read the full OSM PBF (you can select layer types like points, lines, polygons)\npoi <- oe_read(input_pbf, \n                       boundary = philly_boundary, \n                       boundary_type = \"clipsrc\", \n                       layer = \"points\")  # or \"lines\" / \"multipolygons\"\n\n\nkeywords <- c(\"shop\",\"amenity\",\"office\",\"historic\",\"tourism\",\"healthcare\",\n              \"building\",\"leisure\")\npattern <- paste0(keywords, collapse = \"|\")\n\n# ==== Filter by 'other_tags' ====\nif (\"other_tags\" %in% names(poi)) {\n  poi$other_tags <- iconv(as.character(poi$other_tags), from = \"\", to = \"UTF-8\", sub = \"\")\n  poi$other_tags[is.na(poi$other_tags)] <- \"\"\n  \n  poi_filtered <- poi %>%\n    filter(grepl(pattern, other_tags, ignore.case = TRUE))\n  \n  cat(\"filtered POIs found:\", nrow(poi_filtered), \"of\", nrow(poi), \"\\n\")\n  \n} \n```\n:::\n\n\n### Alternative: filtered POI if you donot want to download osm data\n\n::: {.cell}\n\n```{.r .cell-code}\npoi_path <- here(\"final\", \"filtered poi\")\npoi_shp_path=file.path(poi_path, \"philadelphia_poi_filtered.shp\")\npoi=st_read(poi_shp_path)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `philadelphia_poi_filtered' from data source \n  `/Users/ye/Documents/GitHub/portfolio-setup-yezhanggg/final/filtered poi/philadelphia_poi_filtered.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 11161 features and 10 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -75.27472 ymin: 39.87383 xmax: -74.95777 ymax: 40.13445\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n### Kernel Density Rasters (Economic activities density)\n\nInstead of using distance to CBD, we extracted commercial and office points of interests from OpenStreetMap (OSM), and we operate a Kernel Density Estimation (KDE) with a bandwidth of 300 meters. By doing that, we manage to get a surface of density of economic activities across the whole city. The higher the KDE value is, the more economic activities it will be, implying a higher likelihood of the area as a city centers.\n\nThere are several benefits using this approach compared to distance to CBD. First, with the development of sub urbanization, even within the context of Philadelphia County, there is still a shift from monocentric model to polycentric model, meaning there multiple centers/sub centers. Using one CBD fail to capture these sub centers, which may also influence housing price. Second, CBD is an area rather than a point, distance method fail to capture this while the continuous surface computed by KDE would have a value of economic activities across the whole city.\n\n::: {.cell}\n\n```{.r .cell-code}\n# get boundary of Philadelphia County\npa_counties <- counties(state = \"PA\", year = 2023)\n\n# Filter to Philadelphia County\nphilly_boundary <- subset(pa_counties, NAME == \"Philadelphia\")\n\nphilly_boundary <- st_transform(philly_boundary, 3364)  \npoi <- st_transform(poi, 3364)\n# ==== Prepare point pattern ====\n# Convert sf points to spatstat ppp object\nwin <- as.owin(st_union(philly_boundary))  # window from county boundary\ncoords <- st_coordinates(poi)\npp <- ppp(x = coords[,1], y = coords[,2], window = win)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: data contain duplicated points\n```\n\n\n:::\n\n```{.r .cell-code}\n# ==== Run Kernel Density Estimation ====\n# Sigma = bandwidth in map units (here, meters)\ndensity_map <- density.ppp(pp, sigma = 300* 3.28084, edge = TRUE, at = \"pixels\",eps = c(100, 100))\n\n# ==== Convert to raster ====\nr_Economic <- rast(density_map)\ncrs(r_Economic) <- st_crs(philly_boundary)$proj4string\nr_Economic <- mask(r_Economic, vect(philly_boundary))\n```\n:::\n\n\n### Final data frame\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(raster)\n#merge with eviction data\ndf_census_sf_final$KDE <- raster::extract(\n  r_Economic,\n  df_census_sf_final,\n  fun = mean,        \n  na.rm = TRUE\n)\n\ndf_final=df_census_sf_final%>%\n  mutate(date=format(week_date,\"%Y-%m\"))%>%\n  filter(year(week_date) %in% c(2020:2023))%>%\n  left_join(rent_by_month_tract,by=c(\"date\",\"GEOID\"))%>%\n  mutate(EconKDE = KDE$lyr.1)%>%\n  dplyr::select(GEOID,unemployment_rate,foodcpi,electricitycpi,avg_wkly_wage,\n         filings_2020,comcpi,total_pop,pct_white,pct_black,pct_asian,\n         median_hh_income,pct_renter,median_year_built_renter,aggregate_rooms,\n         median_rooms,total_hh,pct_family,median_rent.y,MHI_quantile,week_date,year,EconKDE,pct_rent_burdened)\n```\n:::\n\n\n# EXPLORATORY DATA ANALYSIS\n\nIn this phase, we examine the eviction data to identify initial patterns, trends, and potential relationships across space and time. The goal is to build an early understanding of how eviction filings vary and where there are notable clusters.\n\n### Distribution of eviction counts\n\n::: {.cell}\n\n```{.r .cell-code}\n# aggregate total filings by tract\ntract_totals <- df %>%\n  filter(year(first_of_month) %in% c(2020, 2021, 2022, 2023)) %>%\n  group_by(GEOID) %>%\n  summarise(total_filings = sum(filings_2020, na.rm = TRUE), .groups = \"drop\")\n\n# create histogram\nggplot(tract_totals, aes(x = total_filings)) +\n  geom_histogram(binwidth = 20, fill = \"darkseagreen3\", color = \"white\") +\n  scale_x_continuous(breaks = seq(0, max(tract_totals$total_filings, na.rm = TRUE), by = 100)) +\n  scale_y_continuous(expand = c(0, 0)) +\n  labs(\n    title = \"Distribution of Eviction Filings by Census Tract (2020-2023)\",\n    subtitle = \"Most tracts have fewer than 200 total filings; a few have extremely high counts\",\n    x = \"Eviction Filings\",\n    y = \"Number of Census Tracts\",\n    caption = \"Source: Eviction Lab\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    panel.grid.minor = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nMost of the tracts have filings less than 200. There are some tracts that have more than 500 filings. Overall, we can see the distribution is skewed to the right.This reflects that while eviction is a widespread issue, there are a number of tracts experience high filings. These high-eviction tracts may represent concentrated areas of housing instability and economic issues. \n\n### Monthly Eviction Filings from 2020-2023\n\n::: {.cell}\n\n```{.r .cell-code}\n# aggregate total filings by month across all years\nmonthly_totals <- df %>%\n  mutate(\n    year = year(first_of_month),\n    month = month(first_of_month)\n  ) %>%\n  filter(year %in% c(2020, 2021, 2022, 2023)) %>%\n  group_by(first_of_month) %>%\n  summarise(total_filings = sum(filings_2020, na.rm = TRUE), .groups = \"drop\")\n\n# create histogram/bar chart\nggplot(monthly_totals, aes(x = first_of_month, y = total_filings)) +\n  geom_col(fill = \"darkseagreen3\", color = \"white\", width = 25) +\n  scale_x_date(\n    date_breaks = \"3 months\",\n    date_labels = \"%b\\n%Y\"\n  ) +\n  scale_y_continuous(labels = scales::comma) +\n  labs(\n    title = \"Monthly Eviction Filings in Philadelphia (2020-2023)\",\n    subtitle = \"Note: COVID-19 moratorium caused near-zero filings in April-June 2020\",\n    x = NULL,\n    y = \"Total Eviction Filings\",\n    caption = \"Source: Eviction Lab\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    axis.text.x = element_text(size = 8),\n    panel.grid.minor = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nThis figure displays monthly eviction filings in Philadelphia from January 2020 through late 2023. The COVID-19 eviction caused filings to drop to zero from April-June 2020. By mid-2022, eviction filings surged past pre-pandemic levels, peaking in August 2022 before stabilizing around 2023. There is not a apparent pattern among different month across the year. The overall trend is after pandemic, eviction filings begin to raise and after August 2022 it begins to decline. \n\n### Monthly Eviction Filings by Year\n\n::: {.cell}\n\n```{.r .cell-code}\n# Aggregate by year and month\nmonthly_by_year <- df %>%\n  group_by(year, month) %>%\n  summarise(total_filings = sum(filings_2020, na.rm = TRUE), .groups = \"drop\") %>%\n  filter(year %in% c(2020, 2021, 2022, 2023))\n\n# Function to create plot for each year\nmake_year_plot <- function(data, year_num) {\n  year_data <- data %>% filter(year == year_num)\n  \n  ggplot(year_data) +\n    geom_col(aes(x = factor(month), y = total_filings), \n             fill = \"darkseagreen3\", color = \"black\", width = 0.7) +\n    scale_x_discrete(labels = month.abb) +\n    labs(title = as.character(year_num),\n         x = NULL,\n         y = NULL) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(face = \"bold\", hjust = 0.5, size = 14),\n      axis.text.x = element_text(size = 8, angle = 45, hjust = 1),\n      axis.text.y = element_text(size = 8)\n    )\n}\n\n# Create 4 plots\nplot_list <- map(c(2020, 2021, 2022, 2023), ~make_year_plot(monthly_by_year, .x))\n\n# Arrange 2x2\ncombined <- ggarrange(plotlist = plot_list, ncol = 2, nrow = 2, align = 'hv')\n\nannotate_figure(combined,\n                top = text_grob(\"Monthly Eviction Filings by Year\", \n                                face = \"bold\", size = 16),\n                left = text_grob(\"Total Filings\", rot = 90, size = 12))\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nThis figure shows monthly eviction filings in Philadelphia from 2020 to 2023. The COVID-19 caused filings to drop to near-zero from April to June 2020. Then it followed a recovery period in the late 2020. In 2022 and 2023, eviction filings are at higher levels. Second half of 2021 and 2022 and 2023 all exceed pre-pandemic patterns and showing seasonal peaks in late summer. There isn't a cycle of eviction between different years. \n\n### Eviction Filings by Month Across Years\n\n::: {.cell}\n\n```{.r .cell-code}\n# aggregate by year and month\nmonthly_by_year <- df %>%\n  group_by(year, month) %>%\n  summarise(total_filings = sum(filings_2020, na.rm = TRUE), .groups = \"drop\") %>%\n  filter(year %in% c(2020, 2021, 2022, 2023))\n\n# Function to create plot for each month\nmake_month_plot <- function(data, month_num) {\n  month_data <- data %>% filter(month == month_num)\n  month_label <- month.abb[month_num]\n  \n  years_present <- sort(unique(month_data$year))\n  year_labels <- substr(as.character(years_present), 3, 4)\n  \n  ggplot(month_data) +\n    geom_col(aes(x = factor(year), y = total_filings), \n             fill = \"darkseagreen3\", color = \"black\", width = 0.7) +\n    scale_x_discrete(labels = year_labels) +\n    labs(title = month_label, x = NULL, y = NULL) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(face = \"bold\", hjust = 0.5, size = 11),\n      axis.text.x = element_text(size = 8),\n      axis.text.y = element_text(size = 8)\n    )\n}\n\n# Create 12 plots\nplot_list <- map(1:12, ~make_month_plot(monthly_by_year, .x))\n\n# Arrange 3x4\ncombined <- ggarrange(plotlist = plot_list, ncol = 4, nrow = 3, align = 'hv')\n\nannotate_figure(combined,\n                top = text_grob(\"Eviction Filings by Month Across Years\", \n                                face = \"bold\", size = 14),\n                left = text_grob(\"Total Filings\", rot = 90, size = 11))\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\nThese graphs show the eviction filings across different years by month. There isn't a consistent seasonal pattern, but it is clear that 2022 has some of the highest eviction activity across nearly all months. This spike reflects a major rebound in filings after the expiration of COVID-19 eviction protections. Although levels decline slightly in 2023, they remain higher than 2021. This indicates that the post-pandemic recovery period continues to place sustained pressure on renters.\n\n### Eviction Filings by Quarter Across Years\n\n::: {.cell}\n\n```{.r .cell-code}\n# Aggregate by year and quarter\nquarterly_data <- df %>%\n  mutate(\n    year = year(first_of_month),\n    quarter = quarter(first_of_month)\n  ) %>%\n  filter(year %in% c(2020, 2021, 2022, 2023)) %>%\n  group_by(year, quarter) %>%\n  summarise(total_filings = sum(filings_2020, na.rm = TRUE), .groups = \"drop\")\n\n# Function to create plot for each quarter\nmake_quarter_plot <- function(data, quarter_num) {\n  quarter_data <- data %>% filter(quarter == quarter_num)\n  \n  ggplot(quarter_data) +\n    geom_col(aes(x = factor(year), y = total_filings), \n             fill = \"darkseagreen3\", color = \"black\", width = 0.7) +\n    labs(title = paste0(\"Q\", quarter_num), x = NULL, y = NULL) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(face = \"bold\", hjust = 0.5, size = 14),\n      axis.text.x = element_text(size = 10),\n      axis.text.y = element_text(size = 10)\n    )\n}\n\n# Create 4 plots\nplot_list <- map(1:4, ~make_quarter_plot(quarterly_data, .x))\n\n# Arrange 2x2\ncombined <- ggarrange(plotlist = plot_list, ncol = 2, nrow = 2, align = 'hv')\n\nannotate_figure(combined,\n                top = text_grob(\"Eviction Filings by Quarter (2020-2023)\", \n                                face = \"bold\", size = 16),\n                left = text_grob(\"Total Filings\", rot = 90, size = 12))\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\nThese are graphs that look at eviction filings on a quarterly basis across years. There isn't a consistent pattern that follows through different quarters across years. One noticeable disruption occurs in 2020–2021, when filings dropped sharply due to overlapping federal, state, and local eviction moratoriums. Beginning in 2022, filings raised in all quarters as protections expired. This signals a return toward pre-pandemic eviction situation.\n\n### Eviction Map on Census Tract level from 2020-2023\n\n::: {.cell}\n\n```{.r .cell-code}\n# aggregate filings by GEOID and year\nevictions_by_tract_year <- df %>%\n  group_by(GEOID, year) %>%\n  summarise(total_filings = sum(filings_2020, na.rm = TRUE), .groups = \"drop\") %>%\n  filter(year %in% c(2020, 2021, 2022, 2023))\n\n# join with census tract geometry\nevictions_map_data <- philly_tract_sf %>%\n  left_join(evictions_by_tract_year, by = \"GEOID\")\n\n# function to create map for each year\nmake_year_map <- function(data, year_num) {\n  year_data <- data %>% filter(year == year_num)\n  \n  ggplot(year_data) +\n    geom_sf(aes(fill = total_filings), color = NA, lwd = 0) +\n    scale_fill_viridis_c(\n      option = \"inferno\",\n      name = \"Filings\",\n      na.value = \"grey90\"\n    ) +\n    labs(title = as.character(year_num)) +\n    theme_void() +\n    theme(\n      plot.title = element_text(face = \"bold\", hjust = 0.5, size = 14),\n      legend.position = \"right\",\n      legend.key.height = unit(0.8, \"cm\"),\n      legend.key.width = unit(0.3, \"cm\")\n    )\n}\n\n# create 4 maps\nmap_list <- map(c(2020, 2021, 2022, 2023), ~make_year_map(evictions_map_data, .x))\n\ncombined_maps <- ggarrange(plotlist = map_list, ncol = 2, nrow = 2, \n                            common.legend = TRUE, legend = \"right\")\n\nannotate_figure(combined_maps,\n                top = text_grob(\"Eviction Filings by Census Tract (2020-2023)\", \n                                face = \"bold\", size = 16))\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nEviction hot spots remain spatially persistent across all four years, concentrated in North Philadelphia, West Philadelphia, and parts of Southwest Philadelphia, while Center City and the Far Northeast consistently show lower filing rates. The overall intensity of evictions increased from 2020 to 2023.\n\n### Local Moran's I\n\n::: {.cell}\n\n```{.r .cell-code}\n# aggregate total filings by tract (across all years or pick one year)\nevictions_by_tract <- df %>%\n  filter(year == 2023) %>%\n  group_by(GEOID) %>%\n  summarise(total_filings = sum(filings_2020, na.rm = TRUE), .groups = \"drop\")\n# join to geometry\nevictions_sf <- philly_tract_sf %>%\n  left_join(evictions_by_tract, by = \"GEOID\") %>%\n  filter(!is.na(total_filings))\n# create spatial weights (queen contiguity)\nneighbors <- poly2nb(evictions_sf, queen = TRUE)\nweights <- nb2listw(neighbors, style = \"W\", zero.policy = TRUE)\n# calculate Local Moran's I\nlocal_moran <- localmoran(evictions_sf$total_filings, weights, zero.policy = TRUE)\n# add results to sf object\nevictions_sf <- evictions_sf %>%\n  mutate(\n    local_i = local_moran[, 1],\n    p_value = local_moran[, 5],\n    scaled_filings = scale(total_filings),\n    lag_scaled = lag.listw(weights, scaled_filings, zero.policy = TRUE),\n    # classify hot/cold spots\n    hotspot_type = case_when(\n      scaled_filings > 0 & lag_scaled > 0 & p_value < 0.05 ~ \"Hot Spot (High-High)\",\n      scaled_filings < 0 & lag_scaled < 0 & p_value < 0.05 ~ \"Cold Spot (Low-Low)\",\n      scaled_filings > 0 & lag_scaled < 0 & p_value < 0.05 ~ \"High-Low Outlier\",\n      scaled_filings < 0 & lag_scaled > 0 & p_value < 0.05 ~ \"Low-High Outlier\",\n      TRUE ~ \"Not Significant\"\n    )\n  )\n# plot LISA map\nggplot(evictions_sf) +\n  geom_sf(aes(fill = hotspot_type), color = NA) +\n  scale_fill_manual(\n    values = c(\n      \"Hot Spot (High-High)\" = \"#d7191c\",\n      \"Cold Spot (Low-Low)\" = \"#2c7bb6\",\n      \"High-Low Outlier\" = \"#fdae61\",\n      \"Low-High Outlier\" = \"#abd9e9\",\n      \"Not Significant\" = \"grey90\"\n    ),\n    name = \"Cluster Type\"\n  ) +\n  labs(\n    title = \"Eviction Hot Spots and Cold Spots (2023)\",\n    subtitle = \"Local Moran's I Cluster Analysis\",\n    caption = \"Hot spots = High evictions surrounded by high evictions\"\n  ) +\n  theme_void() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 16),\n    legend.position = \"right\"\n  )\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\nThe map shows that significant eviction hot spots concentrated in North Philadelphia and some part of West Philadelphia, where high-eviction tracts cluster together. Cold spots appear in South Philadelphia and the Far Northeast, indicating areas where low evictions are surrounded by similarly low eviction rates, while most of the city shows no significant spatial clustering.\n\n### Distance from hot spot\n\n::: {.cell}\n\n```{.r .cell-code}\n#identify hot spot centroids from LISA analysis above\nhotspot_tracts <- evictions_sf %>%\n  filter(hotspot_type == \"Hot Spot (High-High)\")\n\nhotspot_centroids <- st_centroid(hotspot_tracts)\n\n# calculate distance from each tract to nearest hot spot\nall_tracts <- philly_tract_sf %>%\n  left_join(evictions_by_tract, by = \"GEOID\")\n\ntract_centroids <- st_centroid(all_tracts)\n\n# distance to nearest hot spot\ndist_to_hotspot <- st_distance(tract_centroids, hotspot_centroids)\nall_tracts$dist_to_hotspot <- apply(dist_to_hotspot, 1, min)\nall_tracts$dist_to_hotspot_km <- as.numeric(all_tracts$dist_to_hotspot) / 1000\n\n# plot distance map\nggplot(all_tracts) +\n  geom_sf(aes(fill = dist_to_hotspot_km), color = NA) +\n  scale_fill_viridis_c(\n    option = \"plasma\",\n    name = \"Distance\\n(km)\",\n    direction = -1\n  ) +\n  geom_sf(data = hotspot_tracts, fill = NA, color = \"red\", size = 0.8) +\n  labs(\n    title = \"Distance to Eviction Hot Spots\",\n    subtitle = \"Red outlines = Hot spot tracts\",\n    caption = \"Darker = closer to high-eviction clusters\"\n  ) +\n  theme_void() +\n  theme(plot.title = element_text(face = \"bold\", size = 16))\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\nThe Far Northeast and South Philadelphia are the most distant from high-eviction clusters, while much of North and West Philadelphia lies within close proximity to hot spots, indicating these areas may be at higher risk of eviction spillover effects.\n\n### Eviction vs Unemployment Rate\n\n::: {.cell}\n\n```{.r .cell-code}\n# prepare data\nmap_data <- df_final %>%\n  st_drop_geometry() %>%  # ADD THIS LINE\n  group_by(GEOID) %>%\n  summarise(\n    total_filings = sum(filings_2020, na.rm = TRUE),\n    unemployment = mean(unemployment_rate, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\nmap_sf <- philly_tract_sf %>%\n  left_join(map_data, by = \"GEOID\") %>%\n  filter(!is.na(total_filings) & !is.na(unemployment))\n\n# create tertiles for each variable\nmap_sf <- map_sf %>%\n  mutate(\n    filings_class = ntile(total_filings, 3),\n    unemp_class = ntile(unemployment, 3),\n    bi_class = paste0(unemp_class, \"-\", filings_class)\n  )\n\n# define bivariate color palette\nbivariate_colors <- c(\n  \"1-1\" = \"#e8e8e8\",  # Low unemployment, Low evictions\n  \"2-1\" = \"#ace4e4\",  # Med unemployment, Low evictions\n  \"3-1\" = \"#5ac8c8\",  # High unemployment, Low evictions\n  \"1-2\" = \"#dfb0d6\",  # Low unemployment, Med evictions\n  \"2-2\" = \"#a5add3\",  # Med unemployment, Med evictions\n  \"3-2\" = \"#5698b9\",  # High unemployment, Med evictions\n  \"1-3\" = \"#be64ac\",  # Low unemployment, High evictions\n  \"2-3\" = \"#8c62aa\",  # Med unemployment, High evictions\n  \"3-3\" = \"#3b4994\"   # High unemployment, High evictions\n)\n\n# map\nmap1 <- ggplot() +\n  geom_sf(data = philly_tract_sf, fill = \"grey90\", color = \"white\", lwd = 0.1) +\n  geom_sf(data = map_sf, aes(fill = bi_class), color = \"white\", lwd = 0.1) +\n  scale_fill_manual(values = bivariate_colors, na.value = \"grey90\", guide = \"none\") +\n  labs(\n    title = \"Eviction Filings vs Unemployment Rate\",\n    subtitle = \"Darker purple = High evictions AND high unemployment\"\n  ) +\n  theme_void() +\n  theme(plot.title = element_text(face = \"bold\", size = 16))\n\n# CREATE LEGEND DATA - this was missing!\nlegend_data <- expand.grid(x = 1:3, y = 1:3) %>%\n  mutate(bi_class = paste0(x, \"-\", y))\n\nlegend1 <- ggplot(legend_data, aes(x = x, y = y, fill = bi_class)) +\n  geom_tile() +\n  scale_fill_manual(values = bivariate_colors, guide = \"none\") +\n  labs(x = \"Unemp. →\", y = \"Evict. →\") +\n  theme_void() +\n  theme(\n    axis.title.x = element_text(size = 9, margin = margin(t = 5)),\n    axis.title.y = element_text(size = 9, angle = 90, margin = margin(r = 5))\n  ) +\n  coord_fixed()\n\nfinal_plot1 <- ggdraw() +\n  draw_plot(map1, 0, 0, 1, 1) +\n  draw_plot(legend1, 0.7, 0.05, 0.22, 0.22)\n\nprint(final_plot1)\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\nThis map shows that high concentration of evictions with high unemployment occurs in North Philadelphia and parts of West Philadelphia. These areas are potentially facing economic hardship. Some South Philadelphia tracts show high unemployment but lower evictions, while the Far Northeast shows low values for both measures, suggesting that unemployment alone does not fully explain eviction patterns.\n\n### Eviction vs Median Gross Rent\n\n::: {.cell}\n\n```{.r .cell-code}\n# prepare data\nmap_data <- df_final %>%\n  st_drop_geometry() %>%  \n  group_by(GEOID) %>%\n  summarise(\n    total_filings = sum(filings_2020, na.rm = TRUE),\n    median_rent = first(median_rent.y),\n    .groups = \"drop\"\n  )\n\nmap_sf <- philly_tract_sf %>%\n  left_join(map_data, by = \"GEOID\") %>%\n  filter(!is.na(total_filings) & !is.na(median_rent))\n\n# create tertiles for each variable\nmap_sf <- map_sf %>%\n  mutate(\n    filings_class = ntile(total_filings, 3),\n    rent_class = ntile(median_rent, 3),\n    bi_class = paste0(rent_class, \"-\", filings_class)\n  )\n\n# define bivariate color palette (different colors for this one)\nbivariate_colors2 <- c(\n  \"1-1\" = \"#e8e8e8\",  # Low rent, Low evictions\n  \"2-1\" = \"#b8d6be\",  # Med rent, Low evictions\n  \"3-1\" = \"#73ae80\",  # High rent, Low evictions\n  \"1-2\" = \"#dfb0d6\",  # Low rent, Med evictions\n  \"2-2\" = \"#a5add3\",  # Med rent, Med evictions\n  \"3-2\" = \"#5698b9\",  # High rent, Med evictions\n  \"1-3\" = \"#be64ac\",  # Low rent, High evictions\n  \"2-3\" = \"#8c62aa\",  # Med rent, High evictions\n  \"3-3\" = \"#3b4994\"   # High rent, High evictions\n)\n\n# map\nmap2 <- ggplot(map_sf) +\n  geom_sf(aes(fill = bi_class), color = NA) +\n  scale_fill_manual(values = bivariate_colors2, na.value = \"grey90\", guide = \"none\") +\n  labs(\n    title = \"Eviction Filings vs Median Rent\",\n    subtitle = \"Darker purple = High evictions AND high rent\"\n  ) +\n  theme_void() +\n  theme(plot.title = element_text(face = \"bold\", size = 16))\n\nlegend_data <- expand.grid(x = 1:3, y = 1:3) %>%\n  mutate(bi_class = paste0(x, \"-\", y))\n\nlegend2 <- ggplot(legend_data, aes(x = x, y = y, fill = bi_class)) +\n  geom_tile() +\n  scale_fill_manual(values = bivariate_colors2, guide = \"none\") +\n  labs(x = \"Rent →\", y = \"Evict. →\") +\n  theme_void() +\n  theme(\n    axis.title.x = element_text(size = 9, margin = margin(t = 5)),\n    axis.title.y = element_text(size = 9, angle = 90, margin = margin(r = 5))\n  ) +\n  coord_fixed()\n\nfinal_plot2 <- ggdraw() +\n  draw_plot(map2, 0, 0, 1, 1) +\n  draw_plot(legend2, 0.7, 0.05, 0.22, 0.22)\n\nprint(final_plot2)\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\nThis map shows that high eviction areas are predominantly concentrated in lower-rent neighborhoods in North and West Philadelphia. High-rent tracts in Center City, University City, and the Far Northeast tend to have lower eviction rates.\n\n### Evication vs Median Household Income\n\n::: {.cell}\n\n```{.r .cell-code}\n# prepare data\nmap_data <- df_final %>%\n  st_drop_geometry() %>%  # ADD THIS LINE\n  group_by(GEOID) %>%\n  summarise(\n    total_filings = sum(filings_2020, na.rm = TRUE),\n    median_income = first(median_hh_income),\n    .groups = \"drop\"\n  )\n\nmap_sf <- philly_tract_sf %>%\n  left_join(map_data, by = \"GEOID\") %>%\n  filter(!is.na(total_filings) & !is.na(median_income))\n\n# create tertiles for each variable\nmap_sf <- map_sf %>%\n  mutate(\n    filings_class = ntile(total_filings, 3),\n    income_class = ntile(median_income, 3),\n    bi_class = paste0(income_class, \"-\", filings_class)\n  )\n\n# define bivariate color palette (blue-red for income-eviction)\nbivariate_colors3 <- c(\n  \"1-1\" = \"#e8e8e8\",  # Low income, Low evictions\n  \"2-1\" = \"#b5c0da\",  # Med income, Low evictions\n  \"3-1\" = \"#6c83b5\",  # High income, Low evictions\n  \"1-2\" = \"#f0b8b8\",  # Low income, Med evictions\n  \"2-2\" = \"#ad9ea5\",  # Med income, Med evictions\n  \"3-2\" = \"#567994\",  # High income, Med evictions\n  \"1-3\" = \"#e64b35\",  # Low income, High evictions\n  \"2-3\" = \"#985356\",  # Med income, High evictions\n  \"3-3\" = \"#3b4994\"   # High income, High evictions\n)\n\n# map\nmap3 <- ggplot(map_sf) +\n  geom_sf(aes(fill = bi_class), color = NA) +\n  scale_fill_manual(values = bivariate_colors3, na.value = \"grey90\", guide = \"none\") +\n  labs(\n    title = \"Eviction Filings vs Median Household Income\",\n    subtitle = \"Orange = High evictions AND low income\"\n  ) +\n  theme_void() +\n  theme(plot.title = element_text(face = \"bold\", size = 16))\n\nlegend_data <- expand.grid(x = 1:3, y = 1:3) %>%\n  mutate(bi_class = paste0(x, \"-\", y))\n\nlegend3 <- ggplot(legend_data, aes(x = x, y = y, fill = bi_class)) +\n  geom_tile() +\n  scale_fill_manual(values = bivariate_colors3, guide = \"none\") +\n  labs(x = \"Income →\", y = \"Evict. →\") +\n  theme_void() +\n  theme(\n    axis.title.x = element_text(size = 9, margin = margin(t = 5)),\n    axis.title.y = element_text(size = 9, angle = 90, margin = margin(r = 5))\n  ) +\n  coord_fixed()\n\nfinal_plot3 <- ggdraw() +\n  draw_plot(map3, 0, 0, 1, 1) +\n  draw_plot(legend3, 0.7, 0.05, 0.22, 0.22)\n\nprint(final_plot3)\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\nThis map shows that most vulnerable tracts—high evictions combined with low household income—concentrated heavily in North Philadelphia, West Philadelphia, and Southwest Philadelphia. Higher-income areas such as Center City, Chestnut Hill, and the Far Northeast consistently show lower eviction rates, demonstrating that evictions disproportionately burden Philadelphia's lowest-income communities where residents have the less financial cushion to absorb economic moves.\n\n# THE EVIDENCE & SOLUATION\n\n**Major Finding:** Eviction filings stayed extremely low before September 2021 because Philadelphia's local Emergency Housing Protection Act (March–August 2020), PHA's internal eviction moratorium (March 2020–March 15, 2021), and the federal CDC eviction moratorium (September 2020–August 26, 2021) collectively prevented most cases from being filed. Once the CDC moratorium was struck down in late August 2021, these protections ended for the majority of renters. As a result, eviction filings began to rise again starting in fall 2021 and continued increasing into 2022.\n\n## Regression\nWe have four different regression models in total, with a very complicated process building and analyzing the models. Equation and table below display the logic of our model building process. \n$$\n\\text{Eviction} = \\text{Census Characteristics} + \\text{Temporal Characteristics} + \\text{Spatial Characteristics}\n$$\n\n| Characteristic Type | Variables |\n|---------------------|-----------|\n| Census Characteristics | Income, race, renters characteristics, median rent (monthly), unit characteristics |\n| Temporal Characteristics | Year, season, policy indicators, CPI, Unemployment rate, wages |\n| Spatial Characteristics | Neighborhood effects, EconKDE |\n\nAs there is barely census level monthly data available, and the temporal range for ACS census is 5 years. We decide a number of temporal variables in a larger geography to account for the monthly change such as City level CPI and unemployment rate. We also add Year, season and policy indicators as 2020-2023 experiences the covid period, and the federal government has publish policy such as eviction moratorium that influences the eviction rate. We believe adding these indicators could better estimate and predict the future evictions.\n\nMoreover, we also add some spatial features to account for the potential spatial autocorrelation. Both neighborhood effects and EconKDE could capture the eviction differences in High/low income neighborhood that makes our predictions accuracy better. \n\n### Create more variables (more feature engineering) before running the regression\n\n::: {.cell}\n\n```{.r .cell-code}\n#calculate eviction by population\ndf_final$evibypop=df_final$filings_2020/df_final$total_pop*100\noutlier_threshold <- df_final %>%\n  filter(!is.na(filings_2020)) %>%\n  pull(filings_2020) %>%          \n  quantile(probs = 0.99)\n#filter the top1% outlier, create log variable\ndf_filtered = df_final %>%\n  filter(!total_pop==0)%>%\n  filter(!is.na(median_rent.y))%>%\n  filter(filings_2020 <= outlier_threshold)%>%\n  mutate(\n    log_pop = log(total_pop + 1),\n    log_rent = log(median_rent.y + 1))\n\ndf_filtered <- df_filtered %>%\n  mutate(\n    # Rent-to-income ratio, as income level may highly correlated with rent level\n    rent_to_income = median_rent.y / (median_hh_income / 12),\n    rent_to_income = ifelse(is.infinite(rent_to_income) | rent_to_income > 2, NA, rent_to_income),\n    \n    # Temporal features\n    mora = ifelse(week_date >= as.Date(\"2020-03-01\") & week_date <= as.Date(\"2021-08-31\"), 1, 0), #mora refers to the federal eviction moratorium period\n    post_mora = ifelse(week_date >= as.Date(\"2021-09-01\") & week_date <= as.Date(\"2022-03-31\"), 1, 0),\n    winter = ifelse(month(week_date) %in% c(11,12, 1), 1, 0) #winter dummy variable\n  ) %>%\n  # Lagged unemployment\n  group_by(GEOID) %>%\n  arrange(GEOID, week_date) %>%\n  mutate(unemployment_lag3 = lag(unemployment_rate, 3))%>% #based on our research, there is at least 45 days for renters to make up until the eviction happens, so we specifically use 3 month lag of unemployment for this effect\n  ungroup()\n```\n:::\n\n\n### Using stargazors for the summary statistics of our final dataframe\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select key variables and create a data frame with proper labels\nsummary_vars <- df_filtered %>%\n  st_drop_geometry() %>%\n  dplyr::select(\n    filings_2020, \n    unemployment_rate,\n    unemployment_lag3,\n    avg_wkly_wage,\n    electricitycpi,\n    foodcpi,\n    comcpi,\n    median_rent.y,\n    pct_renter,\n    rent_to_income,\n    pct_black,\n    pct_family,\n    median_hh_income,\n    total_pop,\n    EconKDE,\n    pct_rent_burdened\n  )\n\nstargazer(\n  as.data.frame(summary_vars),\n  type = \"text\",\n  title = \"Summary Statistics of Key Variables\",\n  covariate.labels = c(\n    \"Eviction Filings\",\n    \"Unemployment Rate (%)\",\n    \"Unemployment Rate (3-month lag) (%)\",\n    \"Average Weekly Wage ($)\",\n    \"Electricity CPI\",\n    \"Food CPI\",\n    \"Commodity CPI\",\n    \"Median Rent ($)\",\n    \"Percent Renter (%)\",\n    \"Rent-to-Income Ratio\",\n    \"Percent Black (%)\",\n    \"Percent Family Households (%)\",\n    \"Median Household Income ($)\",\n    \"Total Population\",\n    \"Economic Activity Density (KDE)\",\n    \"Percent Rent Burdened (%)\"\n  ),\n  summary.stat = c(\"n\", \"mean\", \"sd\", \"min\", \"max\")\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nSummary Statistics of Key Variables\n==================================================================================\nStatistic                             N       Mean     St. Dev.    Min      Max   \n----------------------------------------------------------------------------------\nEviction Filings                    45,349   2.271      2.863       0       15    \nUnemployment Rate (%)               45,349   6.745      3.497     3.700   15.900  \nUnemployment Rate (3-month lag) (%) 44,188   6.818      3.512     3.700   15.900  \nAverage Weekly Wage ()              45,349 1,486.027    82.980    1,363    1,613  \nElectricity CPI                     45,349  203.450     21.899   176.285  237.277 \nFood CPI                            45,349  271.918     20.783   242.456  299.842 \nCommodity CPI                       45,349  206.230     16.677   179.939  222.215 \nMedian Rent ()                      45,349 1,488.804   475.119   400.000 8,500.000\nPercent Renter (%)                  45,349   51.107     20.348    0.000   100.000 \nRent-to-Income Ratio                44,789   0.320      0.174     0.062    1.909  \nPercent Black (%)                   45,349   38.409     32.604    0.000   99.269  \nPercent Family Households (%)       45,349   50.107     16.031    5.882   100.000 \nMedian Household Income ()          44,799 67,990.340 34,623.880 13,721   192,727 \nTotal Population                    45,349 4,047.357  1,583.108    299    10,406  \nEconomic Activity Density (KDE)     45,349   0.0001     0.0001   0.00000  0.0003  \nPercent Rent Burdened (%)           45,313   47.415     16.117    6.349   100.000 \n----------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n\n## Model 1: Possion regression of eviction rate on demographic characteristics\n\n::: {.cell cathe='true'}\n\n```{.r .cell-code}\nlibrary(MASS)\nlibrary(caret)\nlibrary(AER)\n```\n:::\n\n\nAs eviction is count data, we first use Poisson model.  \n\n::: {.cell}\n\n```{.r .cell-code}\n#run regression based on census characteristic\noptions(scipen = 999)\n\nmodel1=glm(filings_2020~pct_white+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+aggregate_rooms+pct_family+total_hh+pct_black+pct_asian,family = \"poisson\",data=df_filtered)\n```\n:::\n\n\n### Check multicollinearity using VIF\nthe VIF for white population, total household and aggregate room is high, implying potential muti-colinearity\n\n::: {.cell}\n\n```{.r .cell-code}\nvif(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               pct_white         median_hh_income               pct_renter \n                7.362691                 2.803368                 2.136801 \n       unemployment_rate median_year_built_renter          aggregate_rooms \n                1.005558                 1.374133                25.462367 \n              pct_family                 total_hh                pct_black \n                2.104085                25.746217                 5.235108 \n               pct_asian \n                1.482007 \n```\n\n\n:::\n:::\n\n\n### Breusch-Pagan test for heteroskedasticity\np value is much smaller than 0.05, showing more variables are needed in the model\n\n::: {.cell}\n\n```{.r .cell-code}\nbptest(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tstudentized Breusch-Pagan test\n\ndata:  model1\nBP = 2939.5, df = 10, p-value < 0.00000000000000022\n```\n\n\n:::\n:::\n\n\n### 10-fold cross validation for model 1\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_control <- trainControl(method = \"cv\", number = 10)\n\nvalidation_model1 <- train(filings_2020 ~ pct_white + median_hh_income + pct_renter + unemployment_rate + \n  median_year_built_renter + aggregate_rooms + pct_family + total_hh + \n  pct_black + pct_asian + offset(log(total_pop)), data = df_filtered,\n               method = \"glm\",family=poisson,\n               trControl = train_control,\n  na.action = na.omit)\n```\n:::\n\n### Test for Dispersion \nover dispersion exists in the data, we have to switch to negative binomial model instead\n\n::: {.cell}\n\n```{.r .cell-code}\ndispersiontest(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tOverdispersion test\n\ndata:  model1\nz = 39.931, p-value < 0.00000000000000022\nalternative hypothesis: true dispersion is greater than 1\nsample estimates:\ndispersion \n  2.376724 \n```\n\n\n:::\n:::\n\n\n\n## Model 2: Negative binomial regression using the same variables\nAs the assumption for poission model does not hold, we use negative binomial model instead\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel2=glm.nb(filings_2020~pct_white+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+aggregate_rooms+pct_family+total_hh+pct_black+pct_asian, data=df_filtered)\n```\n:::\n\n\n### 10-fold cross validation for model 2\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_control <- trainControl(method = \"cv\", number = 10)\n\nvalidation_model2 <- train(filings_2020 ~ pct_white + median_hh_income + pct_renter + unemployment_rate + \n  median_year_built_renter + aggregate_rooms + pct_family + total_hh + \n  pct_black + pct_asian + log_pop, data = df_filtered,\n               method = \"glm.nb\",\n               trControl = train_control,\n  na.action = na.omit,\n  tuneGrid = data.frame(link = \"log\"))\n```\n:::\n\n\n### Model 3: Negative binomial regression with all the cpi, EconKDE, unemployment rate, some period fixed effects and income quantiles\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel3=glm.nb(filings_2020~median_rent.y + avg_wkly_wage + median_hh_income + \n  pct_renter + unemployment_rate + median_year_built_renter + \n  pct_family + pct_black + electricitycpi + factor(year) + \n  MHI_quantile + log_pop+mora+EconKDE+I(EconKDE^2)+foodcpi+comcpi,data=df_filtered)\n```\n:::\n\n\n### Check multicollinearity for Model 3\nHigh VIF score across three cpis, implying muticolinearity\n\n::: {.cell}\n\n```{.r .cell-code}\nvif(model3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                               GVIF Df GVIF^(1/(2*Df))\nmedian_rent.y              1.841830  1        1.357140\navg_wkly_wage              2.691222  1        1.640495\nmedian_hh_income           2.958908  1        1.720148\npct_renter                 2.612671  1        1.616376\nunemployment_rate          3.705838  1        1.925055\nmedian_year_built_renter   1.339727  1        1.157466\npct_family                 2.444267  1        1.563415\npct_black                  1.761404  1        1.327179\nelectricitycpi            27.447492  1        5.239035\nfactor(year)             194.043613  3        2.406116\nMHI_quantile               2.323577  3        1.150870\nlog_pop                    1.199273  1        1.095113\nmora                       4.689154  1        2.165445\nEconKDE                   15.837801  1        3.979673\nI(EconKDE^2)              11.362869  1        3.370885\nfoodcpi                   41.424179  1        6.436162\ncomcpi                    80.830801  1        8.990595\n```\n\n\n:::\n:::\n\n\n### Breusch-Pagan test for heteroskedasticity in Model 3\nstill need to add more variables\n\n::: {.cell}\n\n```{.r .cell-code}\nbptest(model3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tstudentized Breusch-Pagan test\n\ndata:  model3\nBP = 3639.4, df = 21, p-value < 0.00000000000000022\n```\n\n\n:::\n:::\n\n\n### Model 3: 10-fold cross validation for model 3\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_control <- trainControl(method = \"cv\", number = 10)\n\nvalidation_model3 <- train(filings_2020~median_rent.y + avg_wkly_wage + median_hh_income + \n  pct_renter + unemployment_rate + median_year_built_renter + \n  pct_family + pct_black + electricitycpi + factor(year) + \n  MHI_quantile + log_pop+mora+EconKDE+I(EconKDE^2)+foodcpi+comcpi, data = df_filtered,\n               method = \"glm.nb\",\n               trControl = train_control,\n  na.action = na.omit,\n  tuneGrid = data.frame(link = \"log\"))\n```\n:::\n\n\n\n\n\n## Model 4 adding more period fixed effects with lag variables\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel4 <- glm.nb(\n  filings_2020 ~ \n    unemployment_rate  +unemployment_lag3+ avg_wkly_wage + electricitycpi +\n    log_rent + pct_renter + rent_to_income +\n    pct_black + pct_family +\n    mora + post_mora + winter + factor(year) +\n    MHI_quantile  +\n    offset(log_pop)+EconKDE+pct_rent_burdened,\n  data = df_filtered\n)\n```\n:::\n\n### 10-fold cross validation for model 4\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_control <- trainControl(method = \"cv\", number = 10)\n\nvalidation_model4 <- train(filings_2020 ~ \n    unemployment_rate  +unemployment_lag3+ avg_wkly_wage + electricitycpi +\n    log_rent + pct_renter + rent_to_income +\n    pct_black + pct_family +\n    mora + post_mora + winter + factor(year) +\n    MHI_quantile+log_pop+EconKDE+pct_rent_burdened, data = df_filtered,\n               method = \"glm.nb\",\n               trControl = train_control,\n  na.action = na.omit,\n  tuneGrid = data.frame(link = \"log\"))\n```\n:::\n\n\n### Output for model 4 \n\n::: {#tbl-model4-results .cell tbl-cap='Negative Binomial Regression Results (Model 4)'}\n\n```{.r .cell-code}\nstargazer(\n  model4,\n  type = \"html\",\n  title = \"Model 4\",\n  covariate.labels = c(\n    \"Unemployment Rate (%)\",\n    \"Unemployment Rate (3-month lag) (%)\",\n    \"Average Weekly Wage ($)\",\n    \"Electricity CPI\",\n    \"Log(Median Rent)\",\n    \"Percent Renter (%)\",\n    \"Rent-to-Income Ratio\",\n    \"Percent Black (%)\",\n    \"Percent Family Households (%)\",\n    \"Moratorium Period (2020-2021)\",\n    \"Post-Moratorium Period (2021-2022)\",\n    \"Winter Season\",\n    \"Year 2021\",\n    \"Year 2022\",\n    \"Year 2023\",\n    \"Neighborhood Income: Q2\",\n    \"Neighborhood Income: Q3\",\n    \"Neighborhood Income: Q4 (highest)\",\n    \"Economic Activity Density (KDE)\",\n    \"Percent Rent Burdened (%)\"\n  ),\n  dep.var.labels = \"Eviction Filings (Count)\",\n  notes = \"Offset variable: log(Total Population)\",\n  notes.append = TRUE,\n  star.cutoffs = c(0.05, 0.01, 0.001),\n  digit.separator = \",\"\n)\n```\n\n\n<table style=\"text-align:center\"><caption><strong>Model 4</strong></caption>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"></td><td><em>Dependent variable:</em></td></tr>\n<tr><td></td><td colspan=\"1\" style=\"border-bottom: 1px solid black\"></td></tr>\n<tr><td style=\"text-align:left\"></td><td>Eviction Filings (Count)</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Unemployment Rate (%)</td><td>-0.255<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.006)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Unemployment Rate (3-month lag) (%)</td><td>0.058<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.005)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Average Weekly Wage ()</td><td>0.001<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.0001)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Electricity CPI</td><td>0.007<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.001)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Log(Median Rent)</td><td>-0.107<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.028)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Percent Renter (%)</td><td>0.020<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.0004)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Rent-to-Income Ratio</td><td>-0.233<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.041)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Percent Black (%)</td><td>0.010<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.0002)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Percent Family Households (%)</td><td>-0.006<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.001)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Moratorium Period (2020-2021)</td><td>-0.189<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.034)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Post-Moratorium Period (2021-2022)</td><td>-0.310<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.024)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Winter Season</td><td>-0.046<sup>**</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.015)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Year 2021</td><td>-0.321<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.023)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Year 2022</td><td>-0.484<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.038)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Year 2023</td><td>-0.868<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.051)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Neighborhood Income: Q2</td><td>-0.050<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.014)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Neighborhood Income: Q3</td><td>-0.009</td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.017)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Neighborhood Income: Q4 (highest)</td><td>0.140<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.020)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Economic Activity Density (KDE)</td><td>-5,422.083<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(160.652)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Percent Rent Burdened (%)</td><td>0.002<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.0004)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td style=\"text-align:left\">Constant</td><td>-9.371<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.301)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Observations</td><td>40,941</td></tr>\n<tr><td style=\"text-align:left\">Log Likelihood</td><td>-71,713.210</td></tr>\n<tr><td style=\"text-align:left\">theta</td><td>2.039<sup>***</sup> (0.032)</td></tr>\n<tr><td style=\"text-align:left\">Akaike Inf. Crit.</td><td>143,468.400</td></tr>\n<tr><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"><em>Note:</em></td><td style=\"text-align:right\"><sup>*</sup>p<0.05; <sup>**</sup>p<0.01; <sup>***</sup>p<0.001</td></tr>\n<tr><td style=\"text-align:left\"></td><td style=\"text-align:right\">Offset variable: log(Total Population)</td></tr>\n</table>\n:::\n\nThe model shows that current unemployment has a strong negative association with eviction filings (-0.254), while lagged unemployment exhibits a positive effect (0.055), suggesting that evictions may be delayed responses to economic distress as households exhaust resources over time, it makes sense as based on our research, the eviction would not happen after 45 days the renters did not pay rent. Housing affordability measures show mixed effects: while higher median rents are associated with fewer filings (-0.120), as more wealthy people tend to rent expensive apartments, and their wealth made them less likely to violate the contrast (not pay rent). Neighborhoods with higher percentages of renters (0.020) and greater rent burden (0.002) experience more eviction filings, which makes sense. The model captures strong temporal effects, with the eviction moratorium period showing 17% fewer filings (β = -0.182) and the post-moratorium period showing 27% fewer filings (β = -0.311), indicating lasting changes in eviction patterns. Racial disparities are evident, with higher percentages of Black residents associated with increased filings (0.010). Notably, economic activity density has a strong negative association ( -5,370), suggesting that neighborhoods with more concentrated economic opportunities experience fewer evictions, possibly due to better employment access or different housing market dynamics.\n\n\n### Validation comparision between four different models\nBased on the validation result, Model 4 has the lowest RMSE and MAE while still maintain a good R2, as a result, we decide Model 4 as our best model. \n\n::: {.cell}\n\n```{.r .cell-code}\ncv_results <- data.frame(\n  Model = c(\"Model 1: Poisson (Demographics Only)\",\n            \"Model 2: Negative Binomial (Demographics Only)\",\n            \"Model 3: Negative Binomial (+ Economic/Temporal Indicators)\",\n            \"Model 4: Negative Binomial (Full Model)\"),\n  RMSE = c(\n    validation_model1$results$RMSE,\n    validation_model2$results$RMSE[validation_model2$results$link == \"log\"],\n    validation_model3$results$RMSE[validation_model3$results$link == \"log\"],\n    validation_model4$results$RMSE[validation_model4$results$link == \"log\"]\n  ),\n  Rsquared = c(\n    validation_model1$results$Rsquared,\n    validation_model2$results$Rsquared[validation_model2$results$link == \"log\"],\n    validation_model3$results$Rsquared[validation_model3$results$link == \"log\"],\n    validation_model4$results$Rsquared[validation_model4$results$link == \"log\"]\n  ),\n  MAE = c(\n    validation_model1$results$MAE,\n    validation_model2$results$MAE[validation_model2$results$link == \"log\"],\n    validation_model3$results$MAE[validation_model3$results$link == \"log\"],\n    validation_model4$results$MAE[validation_model4$results$link == \"log\"]\n  )\n)\n\n# Round to 3 decimal places\ncv_results$RMSE <- round(cv_results$RMSE, 3)\ncv_results$Rsquared <- round(cv_results$Rsquared, 3)\ncv_results$MAE <- round(cv_results$MAE, 3)\n\nkable(\n  cv_results,\n  col.names = c(\"Model\", \"RMSE\", \"R²\", \"MAE\"),\n  align = c(\"l\", \"c\", \"c\", \"c\"),\n  caption = \"10-Fold Cross-Validation Performance Metrics\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: 10-Fold Cross-Validation Performance Metrics\n\n|Model                                                       | RMSE  |  R²   |  MAE  |\n|:-----------------------------------------------------------|:-----:|:-----:|:-----:|\n|Model 1: Poisson (Demographics Only)                        | 2.354 | 0.324 | 1.613 |\n|Model 2: Negative Binomial (Demographics Only)              | 2.364 | 0.320 | 1.617 |\n|Model 3: Negative Binomial (+ Economic/Temporal Indicators) | 2.298 | 0.360 | 1.580 |\n|Model 4: Negative Binomial (Full Model)                     | 2.256 | 0.355 | 1.548 |\n\n\n:::\n:::\n\n\n### Prediction Error Map\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gridExtra)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'gridExtra'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n\n\n:::\n\n```{.r .cell-code}\n# Generate predictions and errors\ndf_filtered <- df_filtered %>%\n  mutate(\n    predicted = predict(model4, newdata = df_filtered, type = \"response\"),\n    error = filings_2020 - predicted,\n    abs_error = abs(error),\n    time_period = case_when(\n      mora == 1 ~ \"Moratorium\",\n      post_mora == 1 ~ \"Post-Moratorium\",\n      TRUE ~ \"Normal\"\n    )\n  )\n\n# Aggregate errors by tract\ntract_errors_sf <- df_filtered %>%\n  st_drop_geometry() %>%\n  group_by(GEOID) %>%\n  summarize(\n    MAE = mean(abs_error, na.rm = TRUE),\n    avg_filings = mean(filings_2020, na.rm = TRUE),\n    median_income = first(median_hh_income),\n    pct_black = first(pct_black),\n    pct_renter = first(pct_renter),\n    pct_rent_burdened = first(pct_rent_burdened),\n    .groups = \"drop\"\n  ) %>%\n  left_join(philly_tract_sf, ., by = \"GEOID\")\n\n# Prediction Errors\np1 <- ggplot(tract_errors_sf, aes(fill = MAE)) +\n  geom_sf(color = \"white\", size = 0.1) +\n  scale_fill_viridis_c(option = \"plasma\", name = \"MAE\", direction = -1) +\n  labs(title = \"Prediction Errors\") +\n  theme_void() +\n  theme(plot.title = element_text(face = \"bold\", hjust = 0.5))\n\nprint(p1)\n```\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\nThe model shows higher prediction errors concentrated in North Philadelphia and scattered tracts in West Philadelphia. This corresponds to the eviction hot spots identified in the earlier analysis. Lower errors appear in South Philadelphia, Center City, and the Far Northeast, where eviction rates are generally lower and more stable. The gray tracts represent missing data. Overall, the model struggles more in high eviction neighborhoods. It suggests that some additional spatial or socioeconomic features may be needed to improve predictions in these areas. It could be helpful if we could design spatial feature to tacklet the issue. \n\n::: {.cell}\n\n```{.r .cell-code}\n# observed vs predicted by policy period\nggplot(df_filtered, aes(x = filings_2020, y = predicted)) +\n  geom_point(alpha = 0.2, color = \"#3182bd\") +\n  geom_abline(slope = 1, intercept = 0, color = \"red\", linewidth = 1) +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"darkgreen\") +\n  facet_wrap(~time_period) +\n  labs(\n    title = \"Observed vs. Predicted Eviction Filings\",\n    x = \"Observed Filings\",\n    y = \"Predicted Filings\",\n    caption = \"Red = perfect predictions; Green = model fit\"\n  ) +\n  theme_minimal() +\n  theme(plot.title = element_text(face = \"bold\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n\nAcross these three different policy periods, the model underpredicts eviction filings. The model performs best during the Moratorium period when overall filings were low. During the Normal period, the model struggles  with high-filing tracts. The Post-Moratorium period shows a similar pattern of underprediction, indicating the model may be missing some important predictors.\n\n::: {.cell}\n\n```{.r .cell-code}\n# errors vs demographics\nerror_demo_plots <- function(data, x_var, x_lab) {\n  ggplot(data, aes(x = .data[[x_var]], y = MAE)) +\n    geom_point(alpha = 0.5, color = \"#3182bd\") +\n    geom_smooth(method = \"lm\", se = FALSE, color = \"red\") +\n    labs(title = paste(\"Errors vs.\", x_lab), x = x_lab, y = \"MAE\") +\n    theme_minimal()\n}\n\ntract_demo <- tract_errors_sf %>% st_drop_geometry() %>% filter(!is.na(MAE))\n\ngrid.arrange(\n\n  error_demo_plots(tract_demo, \"median_income\", \"Median Income\") + \n    scale_x_continuous(labels = scales::dollar),\n  error_demo_plots(tract_demo, \"pct_black\", \"% Black\"),\n  error_demo_plots(tract_demo, \"pct_renter\", \"% Renter\"),\n  error_demo_plots(tract_demo, \"pct_rent_burdened\", \"% Rent Burdened\"),\n  ncol = 2\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Final_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n\nThe model performs better in higher income tracts, while prediction errors increase in lower income neighborhoods. Tracts with higher Black population percentages show slightly higher MAE. This could reflect that the model have a hard time predicting majority Black community where it face disproportionate eviction rates. Errors increase with higher renter percentages and higher rent burden. These equity patterns raise some concerns on the model is less accurate in communnity that potentially need more attention.\n\n\n# THE IMPLEMENTATION\n\nOne of the primary ways to implement this tool is to develop a Monthly Risk Score based on the prediction. It would be helpful for city agencies to have a map that shows predicted high-risk census tracts and updates the predictions monthly as new data arrives. When a specific tract's risk score exceeds a certain threshold, the city agency should deploy resources to prevent eviction from occurring.\n\nFrom the user's perspective, it would be beneficial to develop an Emergency Rental Assistance Application program. This program should also coordinate with the courts to flag cases that appear in high-risk areas.\n\nFrom a data perspective, we already have the eviction filing, census tract demographics, and economic indicators. These existing resources already provide a large foundation for our prediction model and serve as the base for policy implementation. However, it would also be essential to continue having tools like real-time rental listings that track how the rental listing shifts, as long as these other factors are taken into account.\n\nThese implementation ideas of our solution still have some limitations and raise some ethical concerns.One of the limitations is the model's performance, and the model underpredicts eviction filings, especially in high eviction tracts during the post-moratorium period. The tool may underestimate true risk and lead to insufficient resource allocation precisely where help is needed most.\n\nAnother limitation is on the data aspect. Our model relies on monthly city-level economic indicators rather than tract-level data. Also, the Dewey rental data source gives listing prices and not the actual rents paid. We have more updated data on evictions and rents, but the ACS 5-year estimates limit our prediction model back in time, and we are unable to fully put it to use. \n\nOne more major limitation is the time. Because of the data that we have, we trained on 2020 to 2023 data, which is a period that was heavily influenced by the COVID-19 pandemic and the moratorium relief program. It is not clear how well the model will generalize to future periods. \n\nOne last limitation in our model is the issue of spatial autocorrelation. While we include fixed effect and KED, the prediction error still appears, and that suggests that we didn't really take into account the unmeasured spatial feature and process, and that's what our model currently misses. \n\nWith these limitations and the implementation of the mode, let's discuss some ethical concerns. The model does not perform relatively well in low-income, black, and rent-burdened communities. These communities are the ones that are most in need, and deploying our tool may systemically underpredict some of the struggles that they may be experiencing. This potentially results in us not being able to allocate enough resources on time.\n\nWith one of our implementations, coordinating with courts to flag cases in high-risk areas may raise some privacy concerns. Residents in flagged tracts may face stigmatization, and landlords could use risk to justify discriminatory practices that may not be fair to those residents. It would be important for the affected residents to know how the risk scores are calculated and how the decisions are made based on the prediction. It would be really important to have a clear governance framework that makes the tool accountable and serves the true goods of the impacted community.",
    "supporting": [
      "Final_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}