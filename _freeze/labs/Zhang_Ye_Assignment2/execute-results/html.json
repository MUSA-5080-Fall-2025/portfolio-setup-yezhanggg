{
  "hash": "eb17ef516b5cdb7218f7d28b0459fbf7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Assignment 2: Spatial Analysis and Visualization\"\nsubtitle: \"Healthcare Access and Equity in Pennsylvania\"\nauthor: \"Ye Zhang\"\ndate: \"2025-10-14\"\nformat:\n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\n---\n\n\n## Assignment Overview\n\n**Learning Objectives:**\n- Apply spatial operations to answer policy-relevant research questions\n- Integrate census demographic data with spatial analysis\n- Create publication-quality visualizations and maps\n- Work with spatial data from multiple sources\n- Communicate findings effectively for policy audiences\n\n---\n\n## Part 1: Healthcare Access for Vulnerable Populations\n\n### Research Question\n\n**Which Pennsylvania counties have the highest proportion of vulnerable populations (elderly + low-income) living far from hospitals?**\n\n#### Step 1: Data Collection (5 points)\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(tigris)\nlibrary(tidycensus)\nlibrary(scales)\nlibrary(patchwork)\nlibrary(here)\n\ncensus_api_key(\"138db656646183a18ae51e4a7c1e1f5cd64d4b40\")\ninstall = TRUE\n\n# Load spatial data\n\npa_counties <- st_read(here(\"~/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/Pennsylvania_County_Boundaries.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Pennsylvania_County_Boundaries' from data source \n  `/Users/ye/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/Pennsylvania_County_Boundaries.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 67 features and 19 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -8963377 ymin: 4825316 xmax: -8314404 ymax: 5201413\nProjected CRS: WGS 84 / Pseudo-Mercator\n```\n\n\n:::\n\n```{.r .cell-code}\nhospitals <- st_read(here(\"~/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/hospitals.geojson\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `hospitals' from data source \n  `/Users/ye/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/hospitals.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 223 features and 11 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -80.49621 ymin: 39.75163 xmax: -74.86704 ymax: 42.13403\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\ncensus_tracts <- tracts(state = \"PA\", cb = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n\n```{.r .cell-code}\n# Check that all data loaded correctly\n\nst_crs(pa_counties)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 / Pseudo-Mercator \n  wkt:\nPROJCRS[\"WGS 84 / Pseudo-Mercator\",\n    BASEGEOGCRS[\"WGS 84\",\n        ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n            MEMBER[\"World Geodetic System 1984 (Transit)\"],\n            MEMBER[\"World Geodetic System 1984 (G730)\"],\n            MEMBER[\"World Geodetic System 1984 (G873)\"],\n            MEMBER[\"World Geodetic System 1984 (G1150)\"],\n            MEMBER[\"World Geodetic System 1984 (G1674)\"],\n            MEMBER[\"World Geodetic System 1984 (G1762)\"],\n            MEMBER[\"World Geodetic System 1984 (G2139)\"],\n            MEMBER[\"World Geodetic System 1984 (G2296)\"],\n            ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                LENGTHUNIT[\"metre\",1]],\n            ENSEMBLEACCURACY[2.0]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4326]],\n    CONVERSION[\"Popular Visualisation Pseudo-Mercator\",\n        METHOD[\"Popular Visualisation Pseudo Mercator\",\n            ID[\"EPSG\",1024]],\n        PARAMETER[\"Latitude of natural origin\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"False easting\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"easting (X)\",east,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"northing (Y)\",north,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"Web mapping and visualisation.\"],\n        AREA[\"World between 85.06°S and 85.06°N.\"],\n        BBOX[-85.06,-180,85.06,180]],\n    ID[\"EPSG\",3857]]\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(hospitals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"geodetic latitude (Lat)\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"geodetic longitude (Lon)\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(census_tracts)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: NAD83 \n  wkt:\nGEOGCRS[\"NAD83\",\n    DATUM[\"North American Datum 1983\",\n        ELLIPSOID[\"GRS 1980\",6378137,298.257222101,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"latitude\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"longitude\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4269]]\n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n- How many hospitals are in your dataset?\n  There aer 223 hosptials in my dataset. \n- How many census tracts?\n  There are 3445 census tracts.\n- What coordinate reference system is each dataset in?\n  PA Counties is in WGS 84 Pseudo Mercator, Hospitals is in WGS 84 and Census Tracts is in NAD83.\n\n---\n\n#### Step 2: Get Demographic Data \n\n::: {.cell}\n\n```{.r .cell-code}\n# Get demographic data from ACS\nacs_vars_2022 <- load_variables(2022, \"acs5\", cache = TRUE)\n\n# Get demographic data from ACS\n\npa_demographics <- get_acs(\n  geography = \"tract\",\n  state = \"PA\",\n  variables = c(\n    total_pop = \"B01003_001\",     \n    median_income = \"B19013_001\",   \n    male_65_66 = \"B01001_020\",\n    male_67_69 = \"B01001_021\",\n    male_70_74 = \"B01001_022\",\n    male_75_79 = \"B01001_023\",\n    male_80_84 = \"B01001_024\",\n    male_85_over = \"B01001_025\",\n    female_65_66 = \"B01001_044\",\n    female_67_69 = \"B01001_045\",\n    female_70_74 = \"B01001_046\",\n    female_75_79 = \"B01001_047\",\n    female_80_84 = \"B01001_048\",\n    female_85_over = \"B01001_049\"\n  ),\n  year = 2022,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = FALSE\n)\n\npa_demographics <- pa_demographics %>%\n  mutate(\n    pop_65_over = male_65_66E + male_67_69E + male_70_74E + male_75_79E + \n                  male_80_84E + male_85_overE + \n                  female_65_66E + female_67_69E + female_70_74E + \n                  female_75_79E + female_80_84E + female_85_overE,\n    total_pop = total_popE,\n    median_income = median_incomeE\n  ) %>%\n select(GEOID, total_pop, median_income, pop_65_over)\n\n# Join to tract boundaries\n\ncensus_tracts <- census_tracts %>%\n  left_join(pa_demographics, by = \"GEOID\")\n```\n:::\n\n\n**Questions to answer:**\n- What year of ACS data are you using?\n  I am using ACS 2022 data. \n- How many tracts have missing income data?\n  There are 62 tracts missing income data. \n- What is the median income across all PA census tracts?\n  The median household income is $70,188 for all PA Census Tracts.\n\n---\n\n#### Step 3: Define Vulnerable Populations \n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for vulnerable tracts based on your criteria\n\nvulnerable_tracts <- census_tracts %>%\n  mutate(pct_elderly = (pop_65_over / total_pop) * 100) %>%\n  filter(median_income < 40000 & pct_elderly > 21)\n```\n:::\n\n\n**Questions to answer:**\n- What income threshold did you choose and why?\nThe income threshold that I chose is 40000. Through research, the poverty guideline in 2024 for a family of four is 31,200.The median household income in PA is $76,081 in 2023. Older population might be more vulnerable and it would be reasonable to adjust threshold higher. It would be reasonable to use this as the guideline to set for the low median household income threshold. \n- What elderly population threshold did you choose and why?\nThe elderly population threhold that I choose is 21%. Because after reviewing the acs data, there are 14 different age groups and there are three age groups that include age over 65. \n- How many tracts meet your vulnerability criteria?\nThere are 59 vulnerable tracts that meet my standard of below 40,000 income and over 21% are elderly people. \n- What percentage of PA census tracts are considered vulnerable by your definition?\n1.7% of the PA census tracts are considered as vulnerable by my definition. \n\n---\n\n#### Step 4: Calculate Distance to Hospitals \n\n::: {.cell}\n\n```{.r .cell-code}\n# Transform to appropriate projected CRS\npa_counties <- pa_counties %>% st_transform(3365)\nhospitals <- hospitals %>% st_transform(3365)\ncensus_tracts <- census_tracts %>% st_transform(3365)\nvulnerable_tracts <- vulnerable_tracts %>% st_transform(3365)\n\n# Calculate distance from each tract centroid to nearest hospital\ntract_centers <- st_centroid(vulnerable_tracts) \ndistance_matrix <- st_distance(tract_centers, hospitals)\n\nmin_distances <- apply(distance_matrix, 1, min)\n\nvulnerable_tracts <- vulnerable_tracts %>%\n  mutate(\n    distance_to_nearest_hospital_m = as.numeric(min_distances),\n    distance_to_nearest_hospital_miles = distance_to_nearest_hospital_m / 1609.34\n  )\n```\n:::\n\n\n**Questions to answer:**\n- What is the average distance to the nearest hospital for vulnerable tracts?\nThe average distance is 7.4093 miles.\n- What is the maximum distance?\nThe max distance is 61.2651 miles\n- How many vulnerable tracts are more than 15 miles from the nearest hospital?\nBased on my standards. There are 4 vulnerable tracts that are more than 15 miles from the nearest hospital.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(vulnerable_tracts)$units\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"us-ft\"\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(vulnerable_tracts)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   STATEFP            COUNTYFP           TRACTCE            GEOIDFQ         \n Length:59          Length:59          Length:59          Length:59         \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n    GEOID               NAME             NAMELSAD            STUSPS         \n Length:59          Length:59          Length:59          Length:59         \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n  NAMELSADCO         STATE_NAME            LSAD               ALAND        \n Length:59          Length:59          Length:59          Min.   : 262958  \n Class :character   Class :character   Class :character   1st Qu.: 692938  \n Mode  :character   Mode  :character   Mode  :character   Median :1153118  \n                                                          Mean   :1782766  \n                                                          3rd Qu.:1827787  \n                                                          Max.   :9908475  \n     AWATER         total_pop    median_income    pop_65_over    \n Min.   :     0   Min.   :  19   Min.   :12336   Min.   :   9.0  \n 1st Qu.:     0   1st Qu.:1600   1st Qu.:24081   1st Qu.: 458.5  \n Median :     0   Median :2373   Median :33771   Median : 599.0  \n Mean   : 51871   Mean   :2456   Mean   :30485   Mean   : 658.7  \n 3rd Qu.: 36576   3rd Qu.:2922   3rd Qu.:37470   3rd Qu.: 787.0  \n Max.   :476215   Max.   :5197   Max.   :39891   Max.   :1649.0  \n          geometry   pct_elderly    distance_to_nearest_hospital_m\n MULTIPOLYGON :59   Min.   :21.04   Min.   :  312.1               \n epsg:3365    : 0   1st Qu.:22.80   1st Qu.: 4124.4               \n +proj=lcc ...: 0   Median :25.50   Median : 7340.2               \n                    Mean   :27.47   Mean   :11924.0               \n                    3rd Qu.:31.17   3rd Qu.:14265.6               \n                    Max.   :47.37   Max.   :98596.3               \n distance_to_nearest_hospital_miles\n Min.   : 0.1939                   \n 1st Qu.: 2.5628                   \n Median : 4.5610                   \n Mean   : 7.4093                   \n 3rd Qu.: 8.8643                   \n Max.   :61.2651                   \n```\n\n\n:::\n\n```{.r .cell-code}\nsum(vulnerable_tracts$distance_to_nearest_hospital_miles > 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4\n```\n\n\n:::\n:::\n\n\n---\n\n#### Step 5: Identify Underserved Areas \n\n::: {.cell}\n\n```{.r .cell-code}\n# Create underserved variable\n\nvulnerable_tracts <- vulnerable_tracts %>%\n  mutate(underserved = distance_to_nearest_hospital_miles > 15)\n```\n:::\n\n\n**Questions to answer:**\n- How many tracts are underserved?\nThere are 4 tracts that are underserved.\n- What percentage of vulnerable tracts are underserved?\nThe percentage for vulnerable tracts are underserved is 6.78%.\n- Does this surprise you? Why or why not?\nThis percentage is little bit lower than I expected. I was expected the vulnerable tracts that are underserved might takes up a larger percentage. It might be how I designed what is considered as a vulnerable tracts. \n\n---\n\n#### Step 6: Aggregate to County Level\n\n::: {.cell}\n\n```{.r .cell-code}\n# Spatial join tracts to counties\n\ntracts_with_counties <- vulnerable_tracts %>%\n  st_join(pa_counties %>% select(COUNTY_NAM))\n\n# Aggregate statistics by county\n\nvulnerable_by_county <- tracts_with_counties %>%\n  st_drop_geometry() %>%\n  group_by(COUNTY_NAM) %>%\n  summarize(\n    n_vulnerable_tracts = n(),\n    n_underserved_tracts = sum(underserved == TRUE, na.rm = TRUE),\n    pct_vulnerable_underserved = (sum(underserved == TRUE, na.rm = TRUE) / n()) * 100,\n    avg_distance_to_hospital = mean(distance_to_nearest_hospital_miles, na.rm = TRUE),\n    total_vulnerable_pop = sum(total_pop, na.rm = TRUE)\n  ) %>%\n  arrange(desc(n_vulnerable_tracts))\n\n\nvulnerable_by_county %>%\n  arrange(desc(pct_vulnerable_underserved)) %>%\n  head(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 6\n  COUNTY_NAM     n_vulnerable_tracts n_underserved_tracts pct_vulnerable_under…¹\n  <chr>                        <int>                <int>                  <dbl>\n1 CAMERON                          1                    1                 100   \n2 NORTHUMBERLAND                   1                    1                 100   \n3 CAMBRIA                          4                    1                  25   \n4 ALLEGHENY                       18                    1                   5.56\n5 PHILADELPHIA                    10                    0                   0   \n# ℹ abbreviated name: ¹​pct_vulnerable_underserved\n# ℹ 2 more variables: avg_distance_to_hospital <dbl>,\n#   total_vulnerable_pop <dbl>\n```\n\n\n:::\n\n```{.r .cell-code}\nvulnerable_by_county %>%\n  filter(n_underserved_tracts > 0) %>%\n  arrange(desc(total_vulnerable_pop)) %>%\n  head(10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 6\n  COUNTY_NAM     n_vulnerable_tracts n_underserved_tracts pct_vulnerable_under…¹\n  <chr>                        <int>                <int>                  <dbl>\n1 ALLEGHENY                       18                    1                   5.56\n2 CAMBRIA                          4                    1                  25   \n3 NORTHUMBERLAND                   1                    1                 100   \n4 CAMERON                          1                    1                 100   \n# ℹ abbreviated name: ¹​pct_vulnerable_underserved\n# ℹ 2 more variables: avg_distance_to_hospital <dbl>,\n#   total_vulnerable_pop <dbl>\n```\n\n\n:::\n:::\n\n**Questions to answer:**\n- Which 5 counties have the highest percentage of underserved vulnerable tracts?\nBased on my threshold, the top 4 counties with highest percentage of underserved vulnerable tracts. \n- Which counties have the most vulnerable people living far from hospitals?\nAllegheny has the most vulnerable people living far from hospitals.\n- Are there any patterns in where underserved counties are located?\nUnderserved counties tends to also have higher vulnerable tracts and higher average distance to hospital. \n\n---\n\n#### Step 7: Create Summary Table \n\n::: {.cell}\n\n```{.r .cell-code}\n# Create and format priority counties table\n\nlibrary(knitr)\nlibrary(kableExtra)\n\npriority_counties <- vulnerable_by_county %>%\n  arrange(desc(pct_vulnerable_underserved)) %>%\n  head(10) %>%\n  select(\n    COUNTY_NAM,\n    n_vulnerable_tracts,\n    n_underserved_tracts,\n    pct_vulnerable_underserved,\n    avg_distance_to_hospital,\n    total_vulnerable_pop\n  )\n\npriority_counties %>%\n  kable(\n    col.names = c(\n      \"County\",\n      \"Vulnerable Tracts\",\n      \"Underserved Tracts\",\n      \"% Underserved\",\n      \"Avg Distance (miles)\",\n      \"Vulnerable Population\"\n    ),\n    caption = \"Top 10 Priority Counties for Healthcare Investment: Highest Percentage of Underserved Vulnerable Tracts\",\n    digits = c(0, 0, 0, 1, 1, 0),\n    format.args = list(big.mark = \",\")\n  ) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Top 10 Priority Counties for Healthcare Investment: Highest Percentage of Underserved Vulnerable Tracts</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> County </th>\n   <th style=\"text-align:right;\"> Vulnerable Tracts </th>\n   <th style=\"text-align:right;\"> Underserved Tracts </th>\n   <th style=\"text-align:right;\"> % Underserved </th>\n   <th style=\"text-align:right;\"> Avg Distance (miles) </th>\n   <th style=\"text-align:right;\"> Vulnerable Population </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> CAMERON </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 100.0 </td>\n   <td style=\"text-align:right;\"> 61.3 </td>\n   <td style=\"text-align:right;\"> 1,988 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> NORTHUMBERLAND </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 100.0 </td>\n   <td style=\"text-align:right;\"> 31.2 </td>\n   <td style=\"text-align:right;\"> 2,350 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> CAMBRIA </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 25.0 </td>\n   <td style=\"text-align:right;\"> 11.6 </td>\n   <td style=\"text-align:right;\"> 8,094 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ALLEGHENY </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 5.6 </td>\n   <td style=\"text-align:right;\"> 8.0 </td>\n   <td style=\"text-align:right;\"> 37,378 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> PHILADELPHIA </td>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n   <td style=\"text-align:right;\"> 2.9 </td>\n   <td style=\"text-align:right;\"> 36,700 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WESTMORELAND </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n   <td style=\"text-align:right;\"> 8.1 </td>\n   <td style=\"text-align:right;\"> 8,145 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ERIE </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n   <td style=\"text-align:right;\"> 1.4 </td>\n   <td style=\"text-align:right;\"> 5,320 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LUZERNE </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n   <td style=\"text-align:right;\"> 5.9 </td>\n   <td style=\"text-align:right;\"> 8,633 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> MERCER </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n   <td style=\"text-align:right;\"> 4.6 </td>\n   <td style=\"text-align:right;\"> 6,560 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> BEAVER </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n   <td style=\"text-align:right;\"> 13.8 </td>\n   <td style=\"text-align:right;\"> 3,570 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n---\n\n## Part 2: Comprehensive Visualization \n\n### Map 1: County-Level Choropleth \n\n::: {.cell}\n\n```{.r .cell-code}\n# Create county-level access map\n\nlibrary(scales)\n\ncounties_with_stats <- pa_counties %>%\n  left_join(vulnerable_by_county, by = \"COUNTY_NAM\")\n\nggplot() +\n  geom_sf(data = counties_with_stats, \n          aes(fill = pct_vulnerable_underserved), \n          color = \"white\", \n          size = 0.5) +\n  geom_sf(data = hospitals, \n          color = \"red\", \n          size = 1.5, \n          alpha = 0.6) +\n  scale_fill_viridis_c(\n    name = \"% Vulnerable\\nTracts\\nUnderserved\",\n    labels = comma,\n    option = \"plasma\",\n    na.value = \"lightgray\"\n  ) +\n  labs(\n    title = \"Healthcare Access Challenges in Pennsylvania Counties\",\n    subtitle = \"Percentage of vulnerable tracts located far from hospitals\",\n    caption = \"Source: ACS 2022 | Red points = Hospital locations\"\n  ) +\n  theme_void() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    plot.subtitle = element_text(size = 11),\n    legend.position = \"right\"\n  )\n```\n\n::: {.cell-output-display}\n![](Zhang_Ye_Assignment2_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n---\n\n### Map 2: Detailed Vulnerability Map \n\n::: {.cell}\n\n```{.r .cell-code}\n# Create detailed tract-level map\n\nallegheny <- pa_counties %>%\n  filter(COUNTY_NAM == \"ALLEGHENY\")\n\nallegheny_tracts <- vulnerable_tracts %>%\n  st_filter(allegheny)\n\nallegheny_hospitals <- hospitals %>%\n  st_filter(allegheny)\n\nggplot() +\n  geom_sf(data = allegheny, \n          fill = \"white\", \n          color = \"black\", \n          size = 1) +\n  geom_sf(data = allegheny_tracts %>% filter(underserved == FALSE),\n          fill = \"blue\", \n          color = \"gray80\",\n          size = 0.3,\n          alpha = 0.6) +\n  geom_sf(data = allegheny_tracts %>% filter(underserved == TRUE),\n          fill = \"red\", \n          color = \"gray80\",\n          size = 0.3,\n          alpha = 0.7) +\n  geom_sf(data = allegheny_hospitals, \n          color = \"lightgreen\", \n          size = 2, \n          shape = 17) +\n  labs(\n    title = \"Underserved Vulnerable Populations in Allegheny County\",\n    subtitle = \"Red = Underserved tracts | Blue = Vulnerable tracts | Triangles = Hospitals\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](Zhang_Ye_Assignment2_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n---\n\n### Chart: Distribution Analysis of distances to hospitals for vulnerable populations.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create distribution visualization\n\nggplot(vulnerable_tracts, aes(x = distance_to_nearest_hospital_miles)) +\n  geom_histogram(bins = 20, fill = \"steelblue\", alpha = 0.7, color = \"white\") +\n  geom_vline(xintercept = 15, color = \"red\", linetype = \"dashed\", size = 1) +\n  labs(\n    title = \"Distribution of Distance to Nearest Hospital\",\n    subtitle = \"For vulnerable census tracts in Pennsylvania\",\n    x = \"Distance to Nearest Hospital (miles)\",\n    y = \"Number of Vulnerable Tracts\",\n    caption = \"Red dashed line = 15-mile threshold for underserved status. \n    Most vulnerable tracts are within 15 miles of a hospital, but a concerning number remain beyond this threshold.\"\n  ) +\n  theme_minimal() +\n  scale_x_continuous(labels = comma)\n```\n\n::: {.cell-output-display}\n![](Zhang_Ye_Assignment2_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n---\n\n## Part 3: Bring Your Own Data Analysis \n\n### Your Analysis\n\n**Option B: School Safety Zones**\n- **Data:** Schools, Crime Incidents, Bike Network\n- **Question:** \"Are school zones safe for walking/biking, or are they crime hotspots?\"\n- **Operations:** Buffer schools (500m safety zone), spatial join with crime incidents, assess bike infrastructure coverage\n- **Policy relevance:** Safe Routes to School programs, crossing guard placement\n\n**Your Task:**\n\n1. **Find and load additional data**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load your additional dataset\n\n\nschools <- st_read(here(\"~/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/Challenege/Schools/Schools.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Schools' from data source \n  `/Users/ye/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/Challenege/Schools/Schools.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 495 features and 14 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -8378628 ymin: 4852555 xmax: -8345686 ymax: 4884813\nProjected CRS: WGS 84 / Pseudo-Mercator\n```\n\n\n:::\n\n```{.r .cell-code}\ncrime <- st_read(here(\"~/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/Challenege/incidents_part1_part2/incidents_part1_part2.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `incidents_part1_part2' from data source \n  `/Users/ye/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/Challenege/incidents_part1_part2/incidents_part1_part2.shp' \n  using driver `ESRI Shapefile'\nreplacing null geometries with empty geometries\nSimple feature collection with 169017 features and 13 fields (with 6985 geometries empty)\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -75.2753 ymin: 39.87465 xmax: -74.95761 ymax: 40.13762\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nbike <- st_read(here(\"~/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/Challenege/Bike_Network/Bike_Network.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Bike_Network' from data source \n  `/Users/ye/Documents/GitHub/portfolio-setup-yezhanggg/labs/assignment_2_data/Challenege/Bike_Network/Bike_Network.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 5225 features and 8 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: -8378937 ymin: 4847835 xmax: -8345146 ymax: 4883978\nProjected CRS: WGS 84 / Pseudo-Mercator\n```\n\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(schools)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 / Pseudo-Mercator \n  wkt:\nPROJCRS[\"WGS 84 / Pseudo-Mercator\",\n    BASEGEOGCRS[\"WGS 84\",\n        ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n            MEMBER[\"World Geodetic System 1984 (Transit)\"],\n            MEMBER[\"World Geodetic System 1984 (G730)\"],\n            MEMBER[\"World Geodetic System 1984 (G873)\"],\n            MEMBER[\"World Geodetic System 1984 (G1150)\"],\n            MEMBER[\"World Geodetic System 1984 (G1674)\"],\n            MEMBER[\"World Geodetic System 1984 (G1762)\"],\n            MEMBER[\"World Geodetic System 1984 (G2139)\"],\n            MEMBER[\"World Geodetic System 1984 (G2296)\"],\n            ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                LENGTHUNIT[\"metre\",1]],\n            ENSEMBLEACCURACY[2.0]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4326]],\n    CONVERSION[\"Popular Visualisation Pseudo-Mercator\",\n        METHOD[\"Popular Visualisation Pseudo Mercator\",\n            ID[\"EPSG\",1024]],\n        PARAMETER[\"Latitude of natural origin\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"False easting\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"easting (X)\",east,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"northing (Y)\",north,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"Web mapping and visualisation.\"],\n        AREA[\"World between 85.06°S and 85.06°N.\"],\n        BBOX[-85.06,-180,85.06,180]],\n    ID[\"EPSG\",3857]]\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(crime)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"latitude\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"longitude\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(bike)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 / Pseudo-Mercator \n  wkt:\nPROJCRS[\"WGS 84 / Pseudo-Mercator\",\n    BASEGEOGCRS[\"WGS 84\",\n        ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n            MEMBER[\"World Geodetic System 1984 (Transit)\"],\n            MEMBER[\"World Geodetic System 1984 (G730)\"],\n            MEMBER[\"World Geodetic System 1984 (G873)\"],\n            MEMBER[\"World Geodetic System 1984 (G1150)\"],\n            MEMBER[\"World Geodetic System 1984 (G1674)\"],\n            MEMBER[\"World Geodetic System 1984 (G1762)\"],\n            MEMBER[\"World Geodetic System 1984 (G2139)\"],\n            MEMBER[\"World Geodetic System 1984 (G2296)\"],\n            ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                LENGTHUNIT[\"metre\",1]],\n            ENSEMBLEACCURACY[2.0]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4326]],\n    CONVERSION[\"Popular Visualisation Pseudo-Mercator\",\n        METHOD[\"Popular Visualisation Pseudo Mercator\",\n            ID[\"EPSG\",1024]],\n        PARAMETER[\"Latitude of natural origin\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"False easting\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"easting (X)\",east,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"northing (Y)\",north,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"Web mapping and visualisation.\"],\n        AREA[\"World between 85.06°S and 85.06°N.\"],\n        BBOX[-85.06,-180,85.06,180]],\n    ID[\"EPSG\",3857]]\n```\n\n\n:::\n\n```{.r .cell-code}\nschools <- st_transform(schools, 3365)\ncrime <- st_transform(crime, 3365)\nbike <- st_transform(bike, 3365)\n\nnrow(schools)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 495\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(crime)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 169017\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(bike)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5225\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(st_geometry(schools))\n```\n\n::: {.cell-output-display}\n![](Zhang_Ye_Assignment2_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(st_geometry(crime))\n```\n\n::: {.cell-output-display}\n![](Zhang_Ye_Assignment2_files/figure-html/unnamed-chunk-13-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(st_geometry(bike))\n```\n\n::: {.cell-output-display}\n![](Zhang_Ye_Assignment2_files/figure-html/unnamed-chunk-13-3.png){width=672}\n:::\n:::\n\n\n**Questions to answer:**\n- What dataset did you choose and why?\nI choose schools, bike network and crime incidents to look school safety topics. \n- What is the data source and date?\nAll of the data are downloaded from OpenDataPhilly. Crime incidents data is 2025 and bike network and schools don't have their date included. \n- How many features does it contain?\nThere are 15 features for schoos, 14 features for crime incidents, and 9 features for bike network. \n- What CRS is it in? Did you need to transform it?\nI transformed all of the data into EPSG:3365 for their CRS because it is an optimal option for Philadelphia. \n---\n\n2. **Pose a research question**\n\nAre school zones safe for walking/biking, or are they crime hotspots?\n\n---\n\n3. **Conduct spatial analysis**\n\nUse at least TWO spatial operations to answer your research question.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your spatial analysis\n\n# Operation 1: BUFFERS\n\n#find the buffers around school\nschools_buffer <- schools %>%\n  st_buffer(dist = 500)\n\n# Count crime incidents near each school\nschools_with_crime <- schools %>%\n  mutate(\n    crime_within_500m = lengths(st_intersects(schools_buffer, crime))\n  )\n\n# Summary statistics\ncat(\"Crime incidents near schools:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCrime incidents near schools:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Mean crimes per school:\", mean(schools_with_crime$crime_within_500m), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMean crimes per school: 60.67677 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Max crimes near one school:\", max(schools_with_crime$crime_within_500m), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMax crimes near one school: 490 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Schools with 10+ crimes nearby:\", \n    sum(schools_with_crime$crime_within_500m >= 10), \"\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSchools with 10+ crimes nearby: 439 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"% Schools with 10+ crimes nearby:\",\n    (sum(schools_with_crime$crime_within_500m >= 10))/495, \"\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n% Schools with 10+ crimes nearby: 0.8868687 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Operation 2: SPATIAL JOIN\n\n# Find schools within 200m of bike infrastructure\nschools_near_bikes <- schools %>%\n  st_filter(st_buffer(bike, 200), .predicate = st_intersects) %>%\n  mutate(has_bike_access = TRUE)\n# Calculate percentage\npct_bike_access <- (nrow(schools_near_bikes) / nrow(schools)) * 100\ncat(\"Schools with bike access:\", nrow(schools_near_bikes), \n    \"out of\", nrow(schools), \n    \"(\", round(pct_bike_access, 1), \"%)\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSchools with bike access: 120 out of 495 ( 24.2 %)\n```\n\n\n:::\n\n```{.r .cell-code}\n# Create map\nggplot() +\n  geom_sf(data = bike, color = \"green\", size = 0.5, alpha = 1) +\n  geom_sf(data = crime, color = \"red\", size = 0.000000001, alpha = 0.01) +\n  geom_sf(data = schools_buffer, fill = \"yellow\", alpha = 0.8, color = NA) +\n  geom_sf(data = schools_with_crime, \n          aes(color = crime_within_500m), \n          size = 1) +\n  scale_color_viridis_c(\n    name = \"Crimes within 500m\",\n    option = \"plasma\"\n  ) +\n  labs(\n    title = \"School Safety Analysis: Crime Incidents and Bike Access\",\n    subtitle = \"Yellow zones = 500m school buffers | Green lines = Bike network\",\n    caption = \"Red points = Crime incidents\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](Zhang_Ye_Assignment2_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n**Your interpretation:**\n\nThe mean crime per school is around 60 and the max crime around school is 490 which is super high. There are 495 schools in total and 439 school has crimes over 10+ nearby. 88.7% of all school has crime nearby. 24.2% of the school has access to bike route. With the high percentage of crime present around school is not safe to bike around schools. There might be only a limited number of schools has the level of safety to allow students to bike around schools. \n\n\n## Finally - A few comments about your incorporation of feedback!\n\nRemove extra instruction text and only leave what is important and present the assignment like a presentation. No need to keep the instructions. Be sure to review everything. \n\n---\n",
    "supporting": [
      "Zhang_Ye_Assignment2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}